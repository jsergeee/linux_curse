- **sudo apt install** - загрузка пакетов и обновлений

- **mc** - файловый менеджер как total comander

- **reboot** - перезагрузка

- **Ctrl + L** очистка терминала

- **ls -al** (или просто a - не показывает скрытые) - показ всех каталогов в текущей папке Псевдоним ll (Только для Ubuntu).

- **rm** - удалить файл

- **pwd** - показать тек директорию.

- **mkdir** - создать директорию

- **mkdir -p** Если нужно создать каскад директорий прим. 1/2/3/4/5 просто pwd не может.

- **touch** — создать файл (или изменить существующий, но если файла с таким именем нет, то команда создаст новый, пустой)/

- **rmdir**  Утилита для удаления пустых директорий  Для удаления нужно ввести команду и название директории Например, rmdir dir1

- **rm**  Команда для удаления файлов и директорий  По умолчанию без опций rm не удаляет директории Чтобы удалить пустую директорию, используется опция -d.

- **rm -rf "имя_каталога1"** удаление каталога и всех вложенных каталогов

- **man ____(команда)** - расширенная справка по команде

- **cat "имя_файла" - cat** - команда - распечатывает содержимое файла в терминал

- **cat > "имя_фала"** после > пишем текст котрый должен быть в файле. Завершение Ctrl+D.

- **cp "имя_фала1" "имя__фала2"**  Копируеет файл1 создавая файл2. Только файлы.

- **cp "имя_фала" "имя_катога"** Копируеет файл в каталог.

- **cp -r "имя_каталога1" "имя__каталога2"** копирует каталог1 создвая каталог 2.

- **mv "имя_каталога1" "имя__каталога2"** - перименование катлога если файдк в одной файловой системе.

- **cat "имя_фала1" "имя_фала2" > "имя_фала3"** " склеивает (слияние) файл1 с файлом2 создавая новый файл3

- **ps** - информация о процессах кратко и одномоментно

- **top** - аналог диспетчера задач

### Работа с жесткими ссылками

  - **ln "имя файла" "имя ссылки"** создает ссылку на файл. ссылку можно переносить в другие дериктории.
  - **ln -s** - создание символической ссылки.


# Работа с файлами
======================

# Типы фалов

|Тип|Обозначение (ls)|Обозначение (mc)|
|---|----------------|----------------|
|Обычный файл| – |нет|
|Директория |d |/|
|Блочное устройство| b| +|
|Символьное устройство| c|–|
|UNIX-сокет |s |=|
|Именованный канал |p ||
|Символическая ссылка l| @| и ~ |


# Редактор VIM

Вызов `vim "file_name"`

Hредактиование insert
выход из редктирования esc :wq - сохранение просто q выход без сохраннения.

# Pедактор Nano

Вызов `nano "file_name"`

домик - это ctrl
m - это alt. Отсальное в подсказках

# editor MC

Вызов `mcedit "имя_файла"` как понятно из названия требуется установка пакета MC
выделение в редакторе кнопкой f3, копирование f5, более расшиеренный опции в меню f9

# Tерминальные Пейджеры

Пейджер это аналог команды cat, но для чтения больших файлов прямо в терминале, можно листать и искать текст

Вызов `less "fail_name` 

- **`/`** поиск вперед
- **`?`** посик назад
- **`h`** справка
-  `q`   выход  обращай внимание на расклaдку клавы
- `more` - более старый пейджер сложнее прокртка - через пробел
- `head "имя_файла` - по умолчанию показывает 10  строк добавив к команде -n "кол-во строк" выведется нужное количество строк. `head -n 10 "fail_name"`
- `tail` просмотр полсдених строк файла, используется для просомтра к примеру логов фалов,  Ситаксис: `tail -n 10 "faile_name`. есть спец режим файл будет читается постоянно.`tail -f` выход Ctrl+C


# Права доступа и пользователи


# Переключение между пользователями

`$` - в командной строке означет работа в учетке пользовталя. uid 1000 и больше.

`#` - супер пользователь, для переключения на суперпользователя набрать команду **sudo su** для выхода из суперпользователя команда **exit** uid сперпользователя =0
системный пользователь (deamon) uid от 1 до 1000. нет shel, ограниченные права


# Хранение данных о пользователях
- /etc/passwd – список пользователей при применении cat после команды можно добавить |grep "user_name", это будет поиск по имени user_name 
- /etc/group – группы пользователей
- /etc/shadow – пароли пользователей


# Управление пользователями

## пример создания пользователя:

`sudo useradd -s /bin/bash -m -d /home/testuser testuser`
с помощью команды `at /etc/passwd` проверяем появилcя ли пользователь видми результат:
`testuser:x:30001:30001::/home/testuser:/bin/bash` (пользователь без пароля)

`id` - команда для просмотра сведений о пользователе, и группы куда входит пользователь/
`oem@Lenovo:~$ id
uid=29999(oem) gid=29999(oem) группы=29999(oem),4(adm),24(cdrom),27(sudo),30(dip),46(plugdev),115(lpadmin),127(sambashare)`

`adduser`   создание пользователя (скрипт)
`usermod`  изменение пользователя. 
пример команды `sudo usermod -aG adm testuser` где **-aG** команда **adm** - группа куда добавляем пользователя
`userdel` – удаление пользователя. 
пример: 
`sudo userdel testuser2` прим. домашняя директория остается. для удаления каталогов есть доп команды см. man

`passwd`  изменение пароля если вводим без sudo, то меняем пароль для текущего пользователя пример команды
`sudo passwd testuser`
`chage` – изменение свойств пароля
`groupadd` – создание группы
`groupdel` – удаление группы



# Механизм sudo и su

- `su` – переключение пользователя
- `sudo su` – переключение на
суперпользователя (root)
- `sudo` – выполнение команды с правами
суперпользователя
- /etc/sudoers – конфигурация sudo
- `visudo` – редактирование
вводим команду `udo visudo` - открывется редактор nano.
Под строкой код определяющий работу без пароля
 `Allow members of group sudo to execute any command`
`%sudo   ALL=(ALL:ALL) ALL`
Если команду по умолчанию поменять на:
`%sudo   ALL=(ALL:ALL) NOPASSWD:ALL`
то любой пользователь сможет применять sudo без пароля


# Изменение владельца и группы владельца файлов
- `hown` – изменение владельца и группы
прим: `sudo chown testuser:www-data test3` где tesyuser -пользователь, www-data - группа, test3 - имя файла к кторому производится изменение

- `hown -R` – рекурсивно
для каталога и всез вложенных каталоги а файлов
прим: `sudo chown -R testuser:www-data /home/oem/test1`
- `chown testuser:testgroup`
- `chown testuser`
- `chgrp` – изменение группы
- `chgrp -R` –рекурсивно
пример:  `sudo chgrp -R adm /home/oem/test1`
- `chgrp testgroup`


# Права доступа для файлов и директорий

**-rwxr-xr--** эти обозначения называются биты
**-rwx** владелец
**r-x** группа, пользователь в группе
**r--** dct остальные пользователи


# Специальные биты
`-rwsr-sr-t` rw**s**r SUID 4000 для исполняемых фалов, запуск от имени владельца файла
**s**r SGID 2000 для директорий, создание файлов с группой, назначенной для директории
**t** Sticky bit 1000 для директорий, удаление файлов только владельцем файла или директории
пример:
`ls -sl /usr/bin/passwd`
`60 -rwsr-xr-x 1 root root 59640 янв 25  2018 /usr/bin/passwd`



# Изменение прав доступа
- ● chmod — change mode, изменение прав доступа
- ○ chmod -R testdir/ – рекурсивно
sudo chmod -R 775 test1
было:
drw-rw-r--  5 testuser www-data   4096 окт  5 15:53 test1/
стало:
drwxrwxr-x  5 testuser www-data   4096 окт  5 15:53 test1/

- ○ chmod u=rwx,g=rx,o=r testfile – символьная форма
пример:
было:
`-rw-rw-r--  2 testuser www-data  308 окт  5 15:24 test3`
после
`sudo chmod u=rwx,g=rw,o=rx test3`
стало 
`-rwxrw-r-x  2 testuser www-data  360 окт  5 15:52 test3*`


- ○ chmod 751 testfile – числовая форма
Пример: 
sudo chmod -R 664 test1
для его вычисления можно импользовать mc сочетание клавиш ctrl+x(отпускаем) потом "C" и выбираем каие права нужно присвоить, а в окошке появляются цыфры

- ○ chmod a+x – изменение для всех
sudo chmod +r(или -r) test1 -включает или отключает возможность чтения папки

- ○ chmod 4755 – изменение специальных битов


# Права по умолчанию и umask

||файлы|папки|
|--|-----|-----|
|полные права|666|777|
|Значение umask|022|022|
|Права по умолчанию|644|755|


# Лекция 4. Установка пакетов, репозитории. Планировщик cron



## Официальные репозитории Ubuntu делятся на следующие типы (по версиям ПО): 

- $release — пакеты на момент выхода релиза. 
- $release-security — пакеты критических обновлений безопасности. 
- $release-updates — пакеты обновления системы, то есть более поздние версии ПО, вышедшие уже после релиза.
- $release-backports — пакеты более новых версий ПО, которое доступно только в нестабильных версиях Ubuntu. 
- partner — репозиторий, содержащий ПО компаний-партнёров Canonical.

# Утилиты apt и dpkg 

В Ubuntu управление пакетами осуществляется тремя способами: с использованием утилиты `apt`, `dpkg` или `snap`. Самый удобный в использовании – `apt`. Это пакетный менеджер, который включает в себя набор утилит для управления пакетами. Он позволяет осуществлять поиск, установку и удаление пакетов, обновлять операционную систему, подключать репозитории. Рассмотрим параметры утилиты apt для управления пакетами: 

- `apt list package_name` — поиск пакета по имени; 

- `apt search package_name` — поиск пакета по имени и названию; 

- `apt show package_name` — посмотреть информацию о пакете; 

- `apt install package_name -y` — установить пакет; 

- `pt install package_name1 package_name2 -y` — установить два пакета; 

- `pt remove package_name` — удалить пакет, при этом сохранятся файлы с настройками; 

- `apt purge package_name` — полностью удалить пакет, включая конфигурационные файлы; 

- `apt upgrade` — обновить все установленные пакеты; 

- `apt update` — обновить информацию о пакетах в репозиториях, указанных в настройках. 

  

  **`dpkg`** — пакетный менеджер в Debian-подобных системах. Главное отличие от утилиты apt состоит в том, что dpkg работает только с локальными пакетами, он не умеет искать и устанавливать пакеты из репозиториев. Основные параметры утилиты dpkg: 

- `dpkg -l` — просмотр списка пакетов; 

- `dpkg -i package_name` — установить пакет или группу пакетов; 

- `dpkg -r package_name` — удалить пакет или группу пакетов.

## Альтернативная система snap-пакетов 

**snap** — это пакет, который, помимо готовой сборки самого приложения, включает в себя все необходимые зависимости и может работать почти в любом дистрибутиве Linux. В какой-то степени можно считать, что пакеты, установленные при помощи snap, — альтернатива самостоятельной сборке пакета. Пакет, установленный через snap, содержит все необходимые зависимости и может работать в любом окружении Linux. Snap состоит из двух частей: демона snapd и клиента для управления пакетами snap. Установка snapd производится командой apt install snapd -y. 
Варианты использования команды snap: 
- `snap search package_name` — поиск пакета; 
- `snap install package_name` — установка пакета; 
- s`nap refresh package_name` — обновление пакета; 
- `snap remove package_name` — удаление пакета; 
- `snap list` — просмотр установленных пакетов.



# Планировщик cron



## Пользовательские crontab 

Для управления пользовательскими задачами следует использовать утилиту crontab. Как мы уже знаем, пользовательские файлы crontab нужны для настройки регулярных задач от обычных пользователей. Посмотрим, как можно управлять пользовательскими задачами. 

- Вывести содержимое текущего файла расписания: `rontab -l` 
- Удаление текущего файла расписания: `crontab -r `
- Редактирование текущего файла расписания. При первом запуске будет выведен список поддерживаемых текстовых редакторов: `crontab -e `
- Этот ключ позволяет выполнять вышеописанные действия для другого пользователя: sudo crontab -u username Файлы пользовательских crontab находятся в /var/spool/cron, там можно сразу найти всех пользователей с расписаниями (требуются root-права).





# Урок 9. Лекция: Сетевые возможности Linux

`ip a` - простмотр инофрмации о сети

`ip s -a`  - онфо о статистике

`ip r`  -  инфо о маршрутизации

### Сокеты и порты

! Для просомтра подробностей использовать `sudo`

`ss `- socket start

`ss -ntlp`  - TCP в состоянии LISTEN

`ss -ntulp` - TCP $ UPD  в состоянии LISTEN

`ss -tulpan` - Все TCP & UDP

### Netplan

файл кофигурации сети /etc/netplan/*.yaml

netplan try

netplan apply



### Диагностика сети 

`ping 8.8.8.8` – доступность хоста (ICMP протокол)

`ping ya.ru` – проверка DNS и доступности 

`host -t a yandex.ru` – проверка DNS 

`host -t a yandex.ru 8.8.8.8` – другой DNS-сервер 

`dig @8.8.8.8 google.com` – подробная информация по DNS 

`racepath ya.ru` – просмотр маршрута прохождения пакетов 

`traceroute ya.ru` – альтернатива 

`mtr ya.ru` – постоянный мониторинг доступности хостов

`resolvectl dns` - просмотра DNS серверов

/etc/hosts - файл с настояками хостов

## Фильтрация пакетов

Правила фильтрации

● Просмотр таблицы 

​	○ iptables -L -nv ○ iptables -L -nv -t nat 

● Политика по умолчанию 

​	○ iptables -P INPUT DROP 

● Добавление правил 

​	○ iptables -A INPUT -p tcp --dport 80 -j ACCEPT 

​	○ iptables -I INPUT -p tcp --dport 80 -j ACCEPT 

​	○ iptables -A INPUT -p tcp -s 192.168.0.100 --dport 80 -j DROP 

● Удаление правил ○ iptables -D INPUT 3 

​	○ iptables -D INPUT -p tcp --dport 80 -j ACCEPT 

● Сброс правил ○ iptables -F





## Пример конфигурации сервера



* *SSH allow iptables:**

`-A INPUT -p tcp --dport=22 -j ACCEPT` 

**HTTP, HTTPS allow:**

`iptables -A INPUT -p tcp -m multiport --dport 80,443 -j ACCEPT`  

**loopback allow:**

`iptables -A INPUT -i lo -j ACCEPT `

**ICMP: **

`iptables -A INPUT -p icmp -j ACCEPT` 

**established connections allow: **

`iptables -A INPUT -m state --state ESTABLISHED,RELATED -j ACCEPT` 

**policy drop:**

`iptables -P INPUT DROP`



## Перенаправление портов



● Редирект с 80 на 8080 порт (TCP): 

​	○ iptables -t nat -I PREROUTING -p tcp --dport 80 -j REDIRECT --to-port 8080 

● Проверка: ○ iptables -L -nv -t nat



## Сохранение конфигурации iptables

● Сохранение и восстановление из файла ○ iptables-save > iptables.rules ○ iptables-restore < iptables.rules 

● Сервис netfilter-persistent 

​	○ `apt install iptables-persistent netfilter-persistent `

​	○ `netfilter-persistent save` 

​	○ Конфигурация в /etc/iptables
